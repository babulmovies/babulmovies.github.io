angular.module('MyUtils', [])
    .filter("toTitle", function () {
        return function (input) {
            if (input) {
                var title = input.replace(new RegExp('_', 'g'), ' ');
                return title.replace(/\w\S*/g, function (txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            }
        }
    });

angular.module("BabulmoviesApp", ['MyUtils', 'ngRoute', 'ngResource', 'ngAnimate', 'ngSanitize'], function ($locationProvider) {
    $locationProvider.html5Mode(true);
})
    .controller("IndexController", ['$scope', '$http', function ($scope, $http) {
        $scope.movies = [];

        init();

        function init() {
            $http({
                method: 'GET',
                url: '/data/index.json'
            }).then(function successCallback(response) {
                // console.log('Success' + JSON.stringify(response));
                $scope.movies = response.data;
            }, function errorCallback(response) {
                console.log('Error');
            });
        }
    }])
    .controller("MovieController", ['$scope', '$http', '$location',
        function ($scope, $http, $location) {
            $scope.movie = [];
            var paths = $location.path().split('/');
            if (paths && paths.length > 0) {
                $scope.movieId = paths[paths.length - 1];
                $scope.movieId = $scope.movieId.substr(0, $scope.movieId.lastIndexOf('.'))
            }

            init();

            function init() {
                $http({
                    method: 'GET',
                    url: '/movies/data/' + $scope.movieId + '.json'
                }).then(function successCallback(response) {
                    console.log('Success' + JSON.stringify(response));
                    $scope.movie = response.data;
                }, function errorCallback(response) {
                    console.log('Error');
                });
            }
        }])
    .controller("DownloadController", ['$scope', '$http', '$location',
        function ($scope, $http, $location) {
            $scope.movie = [];
            $scope.movieId = $location.search().id;
            $scope.downloadUrl = $location.search().url;

            init();

            function init() {
                $http({
                    method: 'GET',
                    url: '/movies/data/' + $scope.movieId + '.json'
                }).then(function successCallback(response) {
                    console.log('Success' + JSON.stringify(response));
                    $scope.movie = response.data;
                }, function errorCallback(response) {
                    console.log('Error');
                });
            }
        }]);
